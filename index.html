<!doctype html>
<html>
	<head>
		<title>Socket.IO Chat</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			body {
				font: 13px Helevetica, Arial;
			}
			h2 {
				padding: 0.5em;
				background: #000;
				color: rgb(130, 224, 255);
			}
			#user-name {
				font-style: italic;
			}
			form#send-message {
				background: #000;
				padding: 3px 0px;
				position: fixed;
				bottom: 0;
				width: 100%;
			}
			form#send-message input {
				border: 0;
				padding: 10px;
				width: 90%;
				margin: 0px .33%;
			}
			form#send-message button#send {
				width: 9%;
				background: rgb(130, 224, 255);
				border: none;
				padding: 10px;
			}
			#messages {
				list-style-type: none;
				margin: 0;
				padding: 0;
			}
			#messages li {
				padding: 5px 10px;
			}
			#messages li:nth-child(odd) {
				background: #eee;
			}
			#modal{
				background-color: rgba(50,50,50, 0.5);
		    height: 100%;
		    width: 100%;
		    position: absolute;
		    top: 0;
		    left: 0;
		    z-index: 1000;
			}
			form#pick-name {
				text-align: center;
    		margin-top: 30%;
			}
			button#go {
				margin: 0.5em;
    		padding: 0.2em;
    		vertical-align: middle;
			}
		</style>
	</head>
	<body>

		<h2>
			Connected as <span id="user-name">...<span/>
		</h2>

		<ul id="messages"></ul>

		<form id="send-message" action="">
			<input id="m" autocomplete="off"/><button id="send">Send</button>
		</form>

		<div id="modal">
			<form id="pick-name" action="">
				<input id="n" autocomplete="off" placeholder="Type in your name..."/><button id="go">Go</button>
			</form>
		</div>

		<!-- <script src="/socket.io/socket.io.js"></script> -->
		<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
		<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
		<script>

			function addEntry(entryTxt) {
				$('#messages').append($('<li>').text(entryTxt));
			}
			function getTime() {
				return (new Date()).toString().split(' ')[4];
			}
			function msgEntry(msgData) {
				return '[' + msgData.time + '] ' + msgData.origin + ': ' + msgData.msg
			}

			var userName = '...';

			$('#pick-name').submit(function(){
				userName = $('#n').val();
				$('#user-name').text(userName);
				document.getElementById('modal').hidden = true;

				var socket = io();

				// Register user name
				socket.emit('user_name', userName);

				// Send a message
				$('#send-message').submit(function(){
					var dataOut = {
						origin: userName,
						time: getTime(),
						msg: $('#m').val()
					};
					socket.emit('chat_message', dataOut);
					$('#m').val('');
					return false;
				});

				// Receive messages
				socket.on('chat_message', function(dataIn){
					var txt = msgEntry(dataIn);
					addEntry(txt);
				});

				// Someone else connected
				socket.on('user_connected', function(user_name){
					var txt = user_name + ' connected.';
					addEntry(txt);
				});

				// Someone else disconnected
				socket.on('user_disconnected', function(user_name){
					var txt = user_name + ' disconnected.';
					addEntry(txt);
				});

				return false;
			});
		</script>

	</body>
</html>
